{% extends 'base.html.twig' %}
{% block body %}
  <main id="wrapper-rating" class="container" data-url="{{ weburl }}">
    <div class="font-lg text-center border border-dark mb-2 py-1">Valoración producto</div>
    <div class="d-flex justify-content-around align-items-center">
      <div>
        <div class="h3 font-weight-bold">{{ art.nombre }}</div>
        <div class="font-lg">{{ art.precio_iva | pricenz }}</div>
      </div>
      <div>
        <img class="d-block d-md-none" width="75" src="{{ asset(art.imagen) }}" alt="{{ art.nombre }}"/>
        <img class="d-none d-md-block" width="120" src="{{ asset(art.imagen) }}" alt="{{ art.nombre }}"/>
      </div>
    </div>
    <form action="{{ url('art-valoracion-save') }}" method="POST">
      <input type="hidden" id="rating-referencia" value="{{ art.referencia }}"/>
      <div class="d-flex flex-row flex-wrap">
        <label class="align-self-center pr-2 pb-3 mb-0">Valoración:</label>
        <div class="form-group rating rating-input">
          <input type="radio" name="rating" value="5" id="5"/><label for="5">&#x2606;</label>
          <input type="radio" name="rating" value="4" id="4"/><label for="4">&#x2606;</label>
          <input type="radio" name="rating" value="3" id="3"/><label for="3">&#x2606;</label>
          <input type="radio" name="rating" value="2" id="2"/><label for="2">&#x2606;</label>
          <input type="radio" name="rating" value="1" id="1"/><label for="1">&#x2606;</label>
        </div>
      </div>
      <div class="row">
        <div class="col-12  col-md-6 form-group">
          <label for="rating-alias">Su nombre o seudónimo</label>
          <input type="text" class="form-control" id="rating-alias" required>
          <small class="form-text text-muted">Este nombre se mostrará en las valoraciones del artículo.</small>
        </div>
      </div>
      <div class="row">
        <div class="col-12 form-group">
          <label for="rating-opinion">Su opinión</label>
          <textarea class="form-control" id="rating-opinion" rows="4" required></textarea>
        </div>
      </div>
      <div class="row">
        <div class="col-12 col-md-6 form-group">
          <label for="rating-pros">Ventajas (opcional)</label>
          <textarea class="form-control" id="rating-pros" rows="3"></textarea>
        </div>
        <div class="col-12 col-md-6 form-group">
          <label for="rating-contras">Desventajas (opcional)</label>
          <textarea class="form-control" id="rating-contras" rows="3"></textarea>
        </div>
      </div>
    </div>
  </form>
  <div class="mb-3 d-flex justify-content-around">
    <a href="{{ url('articulo', {weburl: art.url}) }}" class="btn btn-danger px-4">
      <i class="mdi mdi-close-thick mr-2"></i>Volver
    </a>
    <button type="button" id="btn-save-rating" class="btn btn-success px-3">
      <i class="mdi mdi-send mr-2"></i>Enviar opinión
    </button>
  </div>
</main>{% endblock %}{% block javascripts %}
<script>
  $( '#btn-save-rating' ).on( 'click', function() {
    let valor = $( 'input[name="rating"]:checked' ).val();
    if ( ! valor ) {
      T.modalOk( 'Debe valorar su opinión (1-5)', 'Verificación' );
      return;
    }
    if ( $( '#rating-alias' ).isEmpty() ) {
      T.modalOk( 'Debe introducir su nombre o alias', 'Verificación' );
      return;
    }
    if ( $( '#rating-opinion' ).isEmpty() ) {
      T.modalOk( 'Debe introducir su opinión', 'Verificación' );
      return;
    }

    let postData = {
      referencia: '{{ art.referencia }}',
      valoracion: valor,
      opinion: $( '#rating-opinion' ).val(),
      alias: $( '#rating-alias' ).val(),
      pros: $( '#rating-pros' ).val(),
      contras: $( '#rating-contras' ).val()
    };
    $.post( T.path( 'art-valoracion/save' ), postData, function() {
      document.location.href ="{{ url('articulo', {weburl: art.url}) }}";
    } );
  } );
</script>{% endblock %}

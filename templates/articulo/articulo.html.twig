{% extends 'base.html.twig' %}
{% block stylesheets %}
	<style>
		table.table-ref-pn-cba > tbody > tr > td:last-child {
			font-weight: bold;
			padding-left: 5px;
		}
	</style>
{% endblock %}
{% block body %}

	<main id="articulo" data-url="{{ weburl }}">
		<div class="row" style="width:90%; margin:0 auto">
<div class="col-sm-8 galeriaarticulo">
				<div class="mb-1" style="overflow-x:auto">
					<div class="product-other-images" :style="{ width: (10 + imagenes.length * 70) + 'px' }">
						<a v-for="img in imagenes" :href="path(img.large)" data-fancybox="gallery" data-rel="photos-lib">
							<img :alt="img.imagen_txt" :src="path(img.small)" class="miniatura">
						</a>
					</div>
				</div>
				<div class="product-main-image text-center">
					<img class="img-fluid" id="imagen_articulo" :src="imagenPrincipal" :alt="imagenTxt">
				</div>
			</div>
			<div class="col-sm-4 infoarticulo">
				<h1 class="nombrearticulo2">${ art.nombre }</h1>
				<table class="table-ref-pn-cba mt-2">
					<tbody class="d-flex" style="gap:20px">
						<tr>
							<td>Ref.</td>
							<td>${ art.referencia }</td>
						</tr>
						<tr v-if="art.part_number != ''">
							<td>P.N:</td>
							<td>${ art.part_number }</td>
						</tr>
						<tr v-if="art.codbarras != ''">
							<td>Cod.</td>
							<td>${ art.codbarras }</td>
						</tr>
					</tbody>
				</table>

				{% if config.stockUnificar %}
					<img src="{{ asset("images/kit_digital/estrellas.png") }}" alt="1">
					<div v-if="art.stock_remoto">
						<span class="font-weight-bold text-white bg-success px-3">
							{{ config.stockRemoto }}
						</span>
					</div>
					<div v-else v-html="iconStockArticulo" class="availability"></div>
				{% else %}
					<div class="d-flex justify-content-between align-items-center mt-4">
						<img src="{{ asset("images/kit_digital/estrellas.png") }}" alt="1">
						<div v-html="iconStockArticulo" class="availability"></div>
					</div>

				{% endif %}
				<div class="mt-5 d-flex justify-content-end align-items-center" style="text-align:right;" v-if="descuento > 0">
					<span style="margin-right:5px" class="dtoarticulo">DESCUENTO:</span>
					{# 					<span class="mr-5">
																																									<del>${precioSinDto}</del>
																																								</span> #}
					<span class="porcentajedto font-weight-bold">${descuento}%</span>
				</div>
				<div>
					<div class="price-availability-block my-2">
						<div class="price" style="text-align:right">
							<div class="mt-3 d-flex justify-content-between align-items-center">
								<div class="product-quantity product-quantityart">
									<input id="unidades" type="text" v-model="unidades" class="form-control input-sm">
								</div>
								<div class="d-flex justify-content-between align-items-center pagoresponsive" >
									<span style="margin-right:5px" class="dtoarticulo">TOTAL A PAGAR:</span>
									<strong class="totalapagar" v-html="precioArticulo"></strong>
								</div>

							</div>
							<div class="d-inline" v-if="precioArticulo != txtPrecioCero">
								<span class="ml-2" v-if="art.lpi > 0">( IVA y canon incluidos )</span>
								<span class="ml-2" v-else>( IVA incluido )</span>
							</div>
						</div>
					</div>
				</div>

				<div class="row mt-1" v-show="listaTallas.length > 0">
					<label for="talla" class="col-2 col-form-label">Talla</label>
					<div class="col">
						<select id="talla" class="form-control form-control-sm" v-model="talla">
							<option v-for="talla in listaTallas" :key="talla.codigo" :value="talla.codigo">
								${talla.nombre}
							</option>
						</select>
					</div>
				</div>
				<div class="row my-1" v-show="listaColores.length > 0">
					<label for="color" class="col-2 col-form-label">Color</label>
					<div class="col">
						<select id="color" class="form-control form-control-sm" v-model="color">
							<option v-for="color in listaColores" :key="color.codigo" :value="color.codigo">
								${color.nombre}
							</option>
						</select>
					</div>
				</div>
				<div class="product-page-cart" v-if="!art.control_stock || !bloqueo_stock || bloqueo_stock && (stockArticulo > 0 || (art.stock_remoto && {{config.stockUnificar ? 'true': 'false'}}))">

					<button type="button" class="btn btn-primary add2cart" @click="addToCart">AÑADIR AL CARRITO</button>
					<div v-if="art.web_alerta != ''" class="text-danger mt-3">${art.web_alerta}</div>

				</div>
				<div v-else>
					<button type="button" class="btn btn-secondary add2cart" disabled>AÑADIR AL CARRITO</button>
					<div v-if="art.web_alerta != ''" class="text-danger mt-3">${art.web_alerta}</div>

				</div>

				{#         <a v-if="art.url_externa != ''" :href="art.url_externa" target="_blank" rel="noreferrer" class="btn btn-primary mt-2">
																																																												          <i class="mdi mdi-open-in-new mr-3"></i>Enlace externo
																																																												        </a>
																																																												        <a v-if="art.id_documento > 0" :href="urlDocumento" target="_blank" rel="noreferrer" class="btn btn-primary mt-2">
																																																												          <i class="mdi mdi-file-document mr-3"></i>Documento catálogo
																																																												        </a> #}
			</div>
			<div class="col-12">
				<div class="product-page-content">
					<ul class="nav nav-tabs">
						<li class="nav-item">
							<a href="#tab-descripcion" class="nav-link active border-0" data-toggle="tab" aria-controls="tab-descripcion">Descripción</a>
						</li>
						<li class="nav-item" v-if="art.caracteristicas != ''">
							<a href="#tab-especificaciones" class="nav-link border-0" data-toggle="tab" aria-controls="tab-especificaciones">Especificaciones</a>
						</li>
						{% if config.valoraciones %}

							<li class="nav-item">
								<a href="#tab-valoraciones" class="nav-link border-0" data-toggle="tab" aria-controls="tab-valoraciones">Opiniones</a>
							</li>
						{% endif %}
					</ul>
					<div class="tab-content">
						<div class="tab-pane active" id="tab-descripcion" v-html="art.nombre2web"></div>
						<div class="tab-pane" id="tab-especificaciones" v-if="art.caracteristicas != ''" v-html="art.caracteristicas"></div>
						{% if config.valoraciones %}
							<div class="tab-pane" id="tab-valoraciones">
								<div class="row mb-2">
									<div class="col-auto">
										<select v-model="ratingOrder" @change="loadRating" class="form-control">
											<option value="best">Mejores valoraciones</option>
											<option value="new">Más nuevas</option>
											<option value="old">Más antiguas</option>
										</select>
									</div>
									{% if app.user is not empty and app.user.getClient != 0 %}
										<div class="col"></div>
										<div class="col-auto">
											<a href="{{ url('art-valoracion-new', {weburl: art.url}) }}" class="btn btn-primary mb-1">Enviar opinión</a>
										</div>
									{% endif %}
								</div>
								<ul class="list-group">
									<li v-for="item in valoraciones" class="list-group-item">
										<div class="d-flex justify-content-between">
											<span class="font-lg text-warning" v-html="item.valoracion"></span>
											<div>
												<span>${ item.fecha }</span>
												<span v-if="item.intervalo != ''">(${ item.intervalo })</span>
											</div>
										</div>
										<div class="font-weight-bold">
											<span v-text="item.cli_alias"></span>
											<span v-if="item.verificado" class="ml-3 text-success">
												&check; Compra verificada
											</span>
										</div>
										<div>${ item.opinion}</div>
										<div class="my-1">
											<span class="font-weight-bold">Ventajas:</span>
											<span>${ item.pros }</span>
										</div>
										<div>
											<span class="font-weight-bold">Desventajas:</span>
											<span>${ item.contras }</span>
										</div>
									</li>
								</ul>
							</div>
						{% endif %}
					</div>
					<br><br><br>
					{% set landing = landing is defined ? landing : [] %}
					<div class="divarticulosvarios" style="width:80%; margin:0 auto">
						<h2 class="titulogeneral">Quizás También te Interesen estos Productos</h2>
						<div class="product-list-container">
							{% for art in landing|slice(0, 4) %}
								{% include 'articulo/art-minificha.html.twig' %}
							{% endfor %}
						</div>
						<a href="" class="btnvermasarticulos mb-5">IR A LA TIENDA ONLINE</a>
					</div>

				</div>
			</div>
		</div>
	</main>
{% endblock %}
{% block javascripts %}
	<script type="application/ld+json">
		{
																														    "@context": "https://schema.org/",
																														    "@type": "Product",
																														    "name": "{{ art.nombre }}",
																														    "image": "{{ art.imagen }}",
																														    "sku": "{{ art.referencia }}",
		{% if art.part_number is not empty %}
			"mpn": "{{ art.part_number }}",
		{% endif %}
		{% if art.codbarras is not empty %}
			"gtin": "{{ art.codbarras }}",
		{% endif %}
		{% if art.marca is not empty %}
			"brand": { "@type": "Brand", "name": "{{ art.marca }}" },
		{% endif %}
		"description": "{{ art.nombre2web }}",
																														      "offers": {
																														        "@type": "Offer",
																														        "url": "{{ app.request.uri }}",
																														        "priceCurrency": "EUR",
																														        "price": "{{ art.precio_iva }}",
																														        "priceValidUntil": "{{ "now"|date_modify("+1 year")|date("Y-m-d") }}",
																														        "availability": "https://schema.org/InStock",
																														        "seller": { "@type": "Organization", "name": "{{ emp_nombre }}" }
																														      }
																														    }
	</script>
	<script src="{{ asset('js/articulo.js') }}"></script>

	<!-- Script para cambiar la imagen principal al hacer clic en la miniatura -->
	<script>
		document.addEventListener("DOMContentLoaded", function() {
			// Obtener todas las miniaturas
			const miniaturas = document.querySelectorAll('.miniatura');
			const imagenPrincipal = document.getElementById('imagen_articulo');

			// Función para cambiar la imagen principal
			function cambiarImagen(event) {
				event.preventDefault();  // Prevenir el comportamiento por defecto del enlace
				const nuevaImagen = event.target.src.replace('small', 'large'); // Cambiar a la versión grande de la imagen
				imagenPrincipal.src = nuevaImagen; // Actualizar la imagen principal
			}

			// Añadir el evento de clic a cada miniatura
			miniaturas.forEach(miniatura => {
				miniatura.addEventListener('click', cambiarImagen);
			});
		});
	</script>
{% endblock %}
